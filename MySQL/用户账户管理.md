# 用户账户管理

## 1. 用户账户存储

在MySQL下，所有的用户账号，密码，对数据库的操作权限，都存储在`mysql`下（数据库的名字就叫`mysql`）的`user`表格中。

user表格有一个user属性，user属性就是当前所有的用户名。

查看当前mysql的用户一共有多少：

+ 命令

```mysql
use mysql

select user from user;
```

+ 实际操作

```mysql
mysql> use mysql
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> select user from user;
+------------------+
| user             |
+------------------+
| mysql.infoschema |
| mysql.session    |
| mysql.sys        |
| root             |
+------------------+
4 rows in set (0.01 sec)
```

## 2. 用户账户管理

新增用户只需要在user表中使用insert语句增加一条记录即可。

不过为了安全起见不建议这么做，mysql数据库存放着很重要的数据，这样直接对mysql数据库直接操作可能会伤害到mysql服务器。

### 2.1 新增用户

举例：新增用户`zhangsan，pwd=123456`

```mysql
CREATE USER zhangsan IDENTIFIED BY '12345678&Aa';
```

### 2.2 修改用户名

举例：将账户名从`zhangsan`改为`lisi`：

```mysql
mysql> select user from user;
+------------------+
| user             |
+------------------+
| zhangsan         |
| mysql.infoschema |
| mysql.session    |
| mysql.sys        |
| root             |
+------------------+
5 rows in set (0.00 sec)

mysql> RENAME USER zhangsan TO lisi;
Query OK, 0 rows affected (0.00 sec)

mysql> select user from user;
+------------------+
| user             |
+------------------+
| lisi             |
| mysql.infoschema |
| mysql.session    |
| mysql.sys        |
| root             |
+------------------+
5 rows in set (0.00 sec)
```

### 2.3 修改用户密码

举例：修改lisi账户的密码

+ 命令

```mysql
#修改本地用户的密码
ALTER USER '用户名'@'localhost' IDENTIFIED BY '新密码';
# 修改远程用户的密码
ALTER USER '用户名'@'%' IDENTIFIED BY '新密码';

# 执行这些语句后需要刷新权限
FLUSH PRIVILEGES;
```

+ 实践

```mysql
# 修改远程用户的密码
mysql> ALTER USER 'lisi'@'%' IDENTIFIED BY '12345679%Aa';
Query OK, 0 rows affected (0.01 sec)

# 刷新权限
mysql> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.01 sec)
```

## 3. 用户账号删除

删除lisi的账户：

```mysql
mysql> DROP USER lisi;
Query OK, 0 rows affected (0.00 sec)

mysql> select user from user;
+------------------+
| user             |
+------------------+
| mysql.infoschema |
| mysql.session    |
| mysql.sys        |
| root             |
+------------------+
4 rows in set (0.00 sec)
```

## 4. 用户权限控制

### 4.1 查看用户权限

刚创建的用户是没有任何权限的。

```mysql
mysql> CREATE USER zhangsan IDENTIFIED BY '12345678&Aa';
Query OK, 0 rows affected (0.02 sec)

mysql> select user from user;
+------------------+
| user             |
+------------------+
| zhangsan         |
| mysql.infoschema |
| mysql.session    |
| mysql.sys        |
| root             |
+------------------+
5 rows in set (0.00 sec)

mysql> show grants for zhangsan;
+--------------------------------------+
| Grants for zhangsan@%                |
+--------------------------------------+
| GRANT USAGE ON *.* TO `zhangsan`@`%` |
+--------------------------------------+
1 row in set (0.01 sec)
```

### 4.2 用户授权

举例：给用户zhangsan授予查找权限：

```mysql
mysql> GRANT SELECT ON test.* TO zhangsan;
Query OK, 0 rows affected (0.00 sec)

mysql> show grants for zhangsan;
+--------------------------------------------+
| Grants for zhangsan@%                      |
+--------------------------------------------+
| GRANT USAGE ON *.* TO `zhangsan`@`%`       |
| GRANT SELECT ON `test`.* TO `zhangsan`@`%` |
+--------------------------------------------+
2 rows in set (0.00 sec)
```

### 4.3 撤销授权

举例：给用户zhangsan撤销查找权限：

```mysql
mysql> revoke select on test.* from zhangsan;
Query OK, 0 rows affected (0.00 sec)

mysql> show grants for zhangsan;
+--------------------------------------+
| Grants for zhangsan@%                |
+--------------------------------------+
| GRANT USAGE ON *.* TO `zhangsan`@`%` |
+--------------------------------------+
1 row in set (0.00 sec)
```

